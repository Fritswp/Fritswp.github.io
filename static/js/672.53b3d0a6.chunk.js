"use strict";(self.webpackChunkmy_react=self.webpackChunkmy_react||[]).push([[672],{3980:function(e,t,n){n.r(t),n.d(t,{default:function(){return T}});var r=n(9439),s=n(2791),a=n(673),c=n(184),o=function(e){var t=e.handleButtonClick,n=e.isLeftColumnVisible,o=(0,s.useState)("Chat History"),i=(0,r.Z)(o,2),l=i[0],u=i[1],d=(0,s.useState)(null),h=(0,r.Z)(d,2),f=h[0],p=h[1],x=window.innerWidth<=768;(0,s.useEffect)((function(){var e=a.I8.onAuthStateChanged((function(e){p(e||null)}));return function(){return e()}}),[]);var v=function(e){t(e),u(e)},m=function(){window.history.back()};return(0,c.jsx)("div",{className:"chat-left ".concat(n?"":"hide"),children:(0,c.jsxs)("div",{className:"chatleft-column",children:[(0,c.jsxs)("div",{className:"d-none d-md-block mb-4",children:[(0,c.jsx)("div",{className:"avatar-section",children:f&&f.photoURL&&(0,c.jsx)("img",{src:f.photoURL,alt:"Avatar",className:"w-100 h-auto rounded-circle",style:{maxWidth:"12rem"}})}),(0,c.jsx)("hr",{className:"avatar-divider"})]}),(0,c.jsx)("div",{className:"LeftColumn-buttons ",children:(0,c.jsxs)("div",{className:"chatbutton-container flex-wrap justify-content-center justify-content-md-start gap-2",children:[(0,c.jsxs)("div",{className:"button-container",onClick:function(){return v("Chat History")},children:[(0,c.jsx)("button",{type:"button",className:"py-3 px-3 gap-4 chat-btn",children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"})})}),"Chat History"===l&&(0,c.jsx)("div",{className:"activated-indicator"})]}),(0,c.jsxs)("div",{className:"button-container",onClick:function(){return v("Contacts")},children:[(0,c.jsx)("button",{type:"button",className:"py-3 px-3 gap-4 chat-btn",children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"})})}),"Contacts"===l&&(0,c.jsx)("div",{className:"activated-indicator"})]}),(0,c.jsxs)("div",{className:"button-container",onClick:function(){return v("Profile")},children:[(0,c.jsx)("button",{type:"button",className:"py-3 px-3 gap-4 chat-btn",children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})})}),"Profile"===l&&(0,c.jsx)("div",{className:"activated-indicator"})]}),(0,c.jsxs)("div",{className:"button-container",onClick:function(){return v("Settings")},children:[(0,c.jsx)("button",{type:"button",className:"py-3 px-3 gap-4 chat-btn",children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:[(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z"}),(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),"Settings"===l&&(0,c.jsx)("div",{className:"activated-indicator"})]}),x&&(0,c.jsx)("div",{className:"button-container",onClick:function(){return v("Back")},children:(0,c.jsx)("button",{type:"button",className:"py-3 px-3 gap-4 chat-btn",onClick:m,children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})})})})]})}),!x&&(0,c.jsx)("div",{className:"logout-container ",children:(0,c.jsx)("button",{type:"button",className:"py-3 px-3 gap-4 chat-btn",onClick:m,children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})})})})]})})},i=n(7762),l=n(4942),u=n(1413),d=n(4165),h=n(3433),f=n(5861),p=n(2481),x=function(e){var t=e.isActive,n=e.toggleRightColumnVisibility,o=e.updateOtherUserID,x=e.otherUserUID,v=(0,s.useState)(!1),m=(0,r.Z)(v,2),g=(m[0],m[1]),w=(0,s.useState)(""),j=(0,r.Z)(w,2),b=j[0],k=j[1],Z=(0,s.useState)([]),y=(0,r.Z)(Z,2),C=(y[0],y[1]),U=(0,s.useState)([]),N=(0,r.Z)(U,2),S=N[0],L=N[1],M=(0,s.useState)({}),E=(0,r.Z)(M,2),I=E[0],z=E[1],D=(0,s.useState)(!1),J=(0,r.Z)(D,2),H=(J[0],J[1],(0,s.useState)(!1)),T=(0,r.Z)(H,2),R=(T[0],T[1],(0,s.useState)({})),A=(0,r.Z)(R,2),B=A[0],V=A[1],P=(0,s.useState)(null),W=(0,r.Z)(P,2),O=W[0],Q=W[1],G=(0,s.useState)({}),_=(0,r.Z)(G,2),q=_[0],F=_[1];(0,s.useEffect)((function(){if(!window.matchMedia("(max-width: 768px)").matches&&!x&&S.length>0){var e=S[0],t=(null===e||void 0===e?void 0:e.otherUserID)||null;o(t,b)}}),[S,x,b,o]),(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,a.hJ)(a.db,"chats"),e.prev=1,s=(0,a.cf)(n,(function(e){var n=[];e.forEach((function(e){var s=e.id.split("_"),a=(0,r.Z)(s,2),c=a[0],o=a[1];if(c===t||o===t){var i=c===t?o:c;C((function(e){return[].concat((0,h.Z)(e),[i])}));var l=e.data().messages?e.data().messages[e.data().messages.length-1]:null,u=l?l.timestamp.toMillis():null;n.push({id:e.id,data:e.data(),otherUserID:i,lastMessageTime:u})}})),L(n)})),e.abrupt("return",(function(){s()}));case 6:e.prev=6,e.t0=e.catch(1),console.error(e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}(),t=a.I8.onAuthStateChanged((function(t){if(t){var n=t.uid;k(n),e(n)}}));return function(){t()}}),[]);var K=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,s,c,o,i,h,f,p,x;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!I[t]){e.next=2;break}return e.abrupt("return",I[t]);case 2:return n=a.db,r={},e.prev=4,s=(0,a.hJ)(n,"expertApplications"),c=(0,a.JU)(s,t),e.next=9,(0,a.QT)(c);case 9:if(!(o=e.sent).exists()){e.next=15;break}i=o.data(),r={photoURL:i.photoURL||"",displayName:i.displayName||"Unknown"},e.next=21;break;case 15:return h=(0,a.hJ)(n,"userProfiles"),f=(0,a.JU)(h,t),e.next=19,(0,a.QT)(f);case 19:(p=e.sent).exists()&&(x=p.data(),r={photoURL:x.photoURL||"",displayName:x.displayName||"Unknown"});case 21:z((function(e){return(0,u.Z)((0,u.Z)({},e),{},(0,l.Z)({},t,r))})),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(4),console.error(e.t0);case 27:return e.abrupt("return",r);case 28:case"end":return e.stop()}}),e,null,[[4,24]])})));return function(t){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(S.map(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(t.otherUserID);case 2:return n=e.sent,e.abrupt("return",(0,u.Z)((0,u.Z)({},t),{},{userData:n}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:t=e.sent,L(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();S.length>0&&e()}),[S]);var X=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.stopPropagation(),e.prev=1,e.next=4,(0,p.oe)((0,a.JU)(a.db,"chats",t));case 4:o(null,b),L((function(e){return e.filter((function(e){return e.id!==t}))})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}(),Y=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,s,c,o,l,u,h;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.id,s=(0,a.hJ)(a.db,"chats/".concat(r,"/messages")),e.next=5,(0,a.PL)(s);case 5:c=e.sent,o=(0,i.Z)(c.docs),e.prev=7,o.s();case 9:if((l=o.n()).done){e.next=16;break}if(u=l.value,(h=u.data()).receiver!==n||h.isRead){e.next=14;break}return e.abrupt("return",!0);case 14:e.next=9;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(7),o.e(e.t0);case 21:return e.prev=21,o.f(),e.finish(21);case 24:return e.abrupt("return",!1);case 27:return e.prev=27,e.t1=e.catch(0),e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[0,27],[7,18,21,24]])})));return function(t,n){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(S.map((function(e){return Y(e,b)})));case 2:t=e.sent,V(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[S,b]),(0,s.useEffect)((function(){if(b){var e=(0,a.cf)((0,a.hJ)(a.db,"rooms"),(function(e){e.docChanges().forEach((function(e){var t=e.doc,n=t.id,s=t.data(),a=n.split("_"),c=(0,r.Z)(a,2),o=c[0],i=c[1];"added"===e.type?o!==b&&i!==b||!s.offer||Q(o===b?i:o):"removed"===e.type&&(o!==b&&i!==b||Q(null))}))})),t=(0,a.cf)((0,a.hJ)(a.db,"calls"),(function(e){e.docChanges().forEach((function(e){var t=e.doc,n=t.id,s=t.data(),a=n.split("_"),c=(0,r.Z)(a,2),o=c[0],i=c[1];"added"===e.type?o!==b&&i!==b||!s.offer||Q(o===b?i:o):"removed"===e.type&&(o!==b&&i!==b||Q(null))}))}));return function(){e(),t()}}}),[b]);var $=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,s,c,o,i,l,u,h,f;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.id){e.next=14;break}return r=(0,a.hJ)(a.db,"chats/".concat(t.id,"/messages")),s=t.otherUserID,c=(0,a.IO)(r,(0,a.ar)("sender","==",s)),e.next=6,(0,a.PL)(c);case 6:if(!((o=e.sent).docs.length>0)){e.next=14;break}return i=o.docs.reduce((function(e,t){var n=e.data().timestamp.toMillis();return t.data().timestamp.toMillis()>n?t:e})),l={year:"numeric",month:"short",day:"numeric"},u={hour:"numeric",minute:"numeric"},h=i.data().timestamp.toDate().toLocaleTimeString([],u),f=i.data().timestamp.toDate().toLocaleDateString([],l),e.abrupt("return","".concat(h,", ").concat(f));case 14:return e.abrupt("return","");case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,s,a;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={},n=(0,i.Z)(S),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=12;break}return s=r.value,e.next=8,$(s,b);case 8:a=e.sent,t[s.id]=a;case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:F(t);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])})));return function(){return e.apply(this,arguments)}}();e()}),[S,b]);var ee=S.sort((function(e,t){return t.lastMessageTime-e.lastMessageTime}));return(0,c.jsx)("div",{className:t?"visible":"hidden",children:(0,c.jsx)("div",{className:"p-2 flex flex-col gap-2 h-full",children:(0,c.jsxs)("div",{className:" d-flex flex-column gap-2",children:[(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,c.jsx)("div",{children:(0,c.jsx)("h4",{children:"Chats"})}),(0,c.jsxs)("div",{className:"d-flex ",children:[(0,c.jsx)("button",{type:"button",className:"py-3 px-3 gap-4 chat-btn",children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 01-.825-.242m9.345-8.334a2.126 2.126 0 00-.476-.095 48.64 48.64 0 00-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0011.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"})})}),(0,c.jsx)("button",{type:"button",className:"py-3 px-3 gap-4 chat-btn",children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"})})})]})]}),(0,c.jsx)("div",{className:"relative flex flex-col",children:(0,c.jsx)("div",{})}),ee.map((function(e,t){var r,s;return(0,c.jsx)("div",{className:"relative",children:(0,c.jsxs)("button",{className:"chatbutton-history",onClick:function(){return t=e.otherUserID,o(t,b),g(!0),void n();var t},children:[(0,c.jsxs)("div",{className:"d-flex",children:[(0,c.jsx)("div",{className:"avatar-wrapper",children:(0,c.jsx)("div",{className:"avatar-inner ".concat(B[t]||O===e.otherUserID?"unread-border-overlay":""),children:(0,c.jsx)("img",{src:(null===(r=e.userData)||void 0===r?void 0:r.photoURL)||"".concat("","/images/arts/user.webp"),alt:"Avatar",className:"small-avatar-mobile rounded-circle"})})}),(0,c.jsxs)("div",{className:"button-align",children:[(0,c.jsx)("p",{className:"font-weight-bold mb-0 text-start ms-2",children:null===(s=e.userData)||void 0===s?void 0:s.displayName}),(0,c.jsx)("p",{className:"text-start ms-2",children:q[e.id]})," "]})]}),(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",onClick:function(t){return X(e.id,t)},children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})]})},t)}))]})})})},v=n(1087),m=n(2624),g=function(e){var t=e.toggleRightColumnVisibility,n=(0,s.useState)(!1),o=(0,r.Z)(n,2),i=(o[0],o[1],(0,s.useState)([])),l=(0,r.Z)(i,2),h=l[0],x=l[1],g=(0,s.useState)(""),w=(0,r.Z)(g,2),j=w[0],b=w[1],k=(0,s.useState)([]),Z=(0,r.Z)(k,2),y=Z[0],C=Z[1];(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,s,c,o,i,l,h,v,m,g,w,j;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.I8.currentUser){e.next=4;break}return console.error("User is not authenticated"),e.abrupt("return");case 4:return r=(0,p.hJ)(a.RZ,"userProfiles"),s=(0,p.hJ)(a.RZ,"expertApplications"),c=(0,p.JU)(r,t.uid),o=(0,p.JU)(s,t.uid),e.next=10,(0,p.QT)(c);case 10:return i=e.sent,e.next=13,(0,p.QT)(o);case 13:if(l=e.sent,!i.exists()){e.next=18;break}n=c,e.next=24;break;case 18:if(!l.exists()){e.next=22;break}n=o,e.next=24;break;case 22:return console.error("User document not found in either userProfiles or expertApplications"),e.abrupt("return");case 24:return h=(0,p.JU)(a.RZ,n.path),e.next=27,(0,p.QT)(h);case 27:if(!(v=e.sent).exists()){e.next=36;break}return m=v.data(),g=m.contacts||{},w=Object.keys(g).map(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.QT)((0,p.JU)(a.RZ,"userProfiles",t));case 2:if(!(n=e.sent).exists()){e.next=5;break}return e.abrupt("return",(0,u.Z)((0,u.Z)({},n.data()),{},{otherUserUID:n.id}));case 5:return e.next=7,(0,p.QT)((0,p.JU)(a.RZ,"expertApplications",t));case 7:if(!(r=e.sent).exists()){e.next=10;break}return e.abrupt("return",(0,u.Z)((0,u.Z)({},r.data()),{},{otherUserUID:r.id}));case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=34,Promise.all(w);case 34:j=e.sent,x(j.filter(Boolean));case 36:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]),(0,s.useEffect)((function(){if(""!==j.trim()){var e=new m.Z(h,{keys:["displayName","occupation","keywords"],includeScore:!0,includeMatches:!0,threshold:.4}).search(j).map((function(e){return e.item}));C(e)}else C(h)}),[j,h]);var U=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(n){var r,s,c,o,i,l;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(),e.prev=1,r=(0,p.hJ)(a.RZ,"expertApplications"),e.next=5,(0,p.QT)((0,p.JU)(r,n.otherUserUID));case 5:if(s=e.sent,console.log("Expert Doc Snap:",s.data()),!s.exists()){e.next=13;break}c=s.data().customURL,console.log("Custom URL:",c),window.location.href="/expert/".concat(c),e.next=19;break;case 13:return o=(0,p.hJ)(a.RZ,"userProfiles"),e.next=16,(0,p.QT)((0,p.JU)(o,n.otherUserUID));case 16:i=e.sent,console.log("User Doc Snap:",i.data()),i.exists()?(l=i.data().customURL,console.log("Custom URL:",l),window.location.href="/user/".concat(l)):console.log("User profile not found for the specified UID.");case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),console.error("Error handling button click:",e.t0.message);case 24:case"end":return e.stop()}}),e,null,[[1,21]])})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,s,c,o,i,l,u,f,v,m,g;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=a.I8.currentUser){e.next=5;break}return console.error("User is not authenticated"),e.abrupt("return");case 5:return s=(0,p.hJ)(a.RZ,"userProfiles"),c=(0,p.hJ)(a.RZ,"expertApplications"),o=(0,p.JU)(s,n.uid),i=(0,p.JU)(c,n.uid),e.next=11,(0,p.QT)(o);case 11:return l=e.sent,e.next=14,(0,p.QT)(i);case 14:if(u=e.sent,!l.exists()){e.next=19;break}r=o,e.next=25;break;case 19:if(!u.exists()){e.next=23;break}r=i,e.next=25;break;case 23:return console.error("User document not found in either userProfiles or expertApplications"),e.abrupt("return");case 25:return f=(0,p.JU)(a.RZ,r.path),e.next=28,(0,p.QT)(f);case 28:if(!(v=e.sent).exists()){e.next=37;break}return m=v.data(),delete(g=m.contacts||{})[t],e.next=35,(0,p.r7)(f,{contacts:g});case 35:x(h.filter((function(e){return e.otherUserUID!==t}))),C(y.filter((function(e){return e.otherUserUID!==t})));case 37:e.next=42;break;case 39:e.prev=39,e.t0=e.catch(0),console.error("Error deleting contact:",e.t0.message);case 42:case"end":return e.stop()}}),e,null,[[0,39]])})));return function(t){return e.apply(this,arguments)}}();return(0,c.jsxs)("div",{className:"d-flex flex-column gap-2 mt-3",children:[(0,c.jsx)("div",{className:"input-container",children:(0,c.jsx)("input",{type:"text",className:"chat-search-input",placeholder:"Search for Experts",value:j,onChange:function(e){b(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&t()}})}),(0,c.jsx)("div",{className:"contacts-list",children:y.map((function(e,t){return(0,c.jsx)(v.rU,{children:(0,c.jsxs)("button",{className:"chatbutton-history",onClick:function(){return U(e)},children:[(0,c.jsxs)("div",{className:"d-flex",children:[(0,c.jsx)("div",{className:"small-avatar",children:(0,c.jsx)("img",{src:e.photoURL||"avatar.png",alt:"Avatar",className:"w-100 h-auto rounded-circle",style:{maxWidth:"12rem"}})}),(0,c.jsxs)("div",{className:"button-align",children:[(0,c.jsx)("p",{className:"font-weight-bold mb-0 text-start ms-2",children:e.displayName}),(0,c.jsx)("p",{className:"font-weight-bold mb-0 ms-2 text-muted",children:e.occupation})]})]}),(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",onClick:function(t){t.preventDefault(),t.stopPropagation(),N(e.otherUserUID)},children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})]})},t)}))})]})},w=function(){var e=(0,s.useState)(null),t=(0,r.Z)(e,2),n=t[0],o=t[1],i=(0,s.useState)(""),l=(0,r.Z)(i,2),u=l[0],h=l[1],x=(0,s.useState)(""),v=(0,r.Z)(x,2),m=v[0],g=v[1],w=(0,s.useState)(""),j=(0,r.Z)(w,2),b=j[0],k=j[1];return(0,s.useEffect)((function(){var e=a.I8.onAuthStateChanged(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,s,c,i,l;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=20;break}return o(t),n=(0,p.JU)(a.RZ,"expertApplications",t.uid),e.next=5,(0,p.QT)(n);case 5:if(!(r=e.sent).exists()){e.next=13;break}s=r.data(),h(s.description||""),g(s.city||""),k(s.email||""),e.next=18;break;case 13:return c=(0,p.JU)(a.RZ,"userProfiles",t.uid),e.next=16,(0,p.QT)(c);case 16:(i=e.sent).exists()?(l=i.data(),h(l.description||""),g(l.city||""),k(l.email||"")):(h("Description not found"),g("City not found"));case 18:e.next=24;break;case 20:o(null),h(""),g(""),k("");case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return function(){return e()}}),[]),(0,c.jsxs)("div",{className:"d-flex flex-column gap-2 mt-3",children:[(0,c.jsx)("div",{className:"justify-content-center align-items-center px-8",children:(0,c.jsxs)("div",{className:"text-center",children:[n&&n.photoURL&&(0,c.jsx)("img",{className:"medium-avatar mx-auto user-avatar mb-2",src:n.photoURL,alt:"User Avatar"}),n&&n.displayName&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("h4",{children:n.displayName}),(0,c.jsx)("p",{className:"text-muted",children:u})," ",(0,c.jsx)("hr",{className:"avatar-divider"})]})]})}),(0,c.jsxs)("div",{className:"langauges-spacing chat-btn-profile ",style:{transform:"none"},children:[(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",height:"30",width:"30",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"})}),b]}),(0,c.jsxs)("div",{className:"langauges-spacing chat-btn-profile ",style:{transform:"none"},children:[(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",height:"30",width:"30",children:[(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"}),(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"})]}),m]})]})},j=function(e){var t=e.selectedMenu,n=e.toggleRightColumnVisibility,a=e.updateOtherUserID,o=e.isMiddleColumnVisible,i=e.setActiveButton,l=e.otherUserUID,u=e.currentUserUID,d=(0,s.useState)(t),h=(0,r.Z)(d,2),f=h[0],p=h[1],v=(0,s.useState)(!0),m=(0,r.Z)(v,2),j=m[0],b=m[1],k=(0,s.useState)(!0),Z=(0,r.Z)(k,2),y=Z[0],C=Z[1];(0,s.useEffect)((function(){b(!1);var e=setTimeout((function(){p(t),b(!0),C("Chat History"===t)}),300);return function(){return clearTimeout(e)}}),[t]);return(0,c.jsxs)("div",{className:"chat-middle pt-4 ".concat(o?"":"hide"),children:[(0,c.jsx)("div",{className:"chat-component ".concat(j&&y?"visible":"hidden"),children:"Chat History"===f&&(0,c.jsx)(x,{otherUserUID:l,updateOtherUserID:a,toggleRightColumnVisibility:n,currentUserUID:u})}),(0,c.jsx)("div",{className:"contacts-component ".concat(j&&!y?"visible":"hidden"),children:"Contacts"===f&&(0,c.jsx)(g,{switchToChatHistory:function(e){p("Chat History"),C(!0),e("Chat History")},setActiveButton:i,toggleRightColumnVisibility:n})}),(0,c.jsx)("div",{className:"profile-component ".concat(j&&"Profile"===f?"visible":"hidden"),children:"Profile"===f&&(0,c.jsx)(w,{})})]})},b=n(5372),k=n(2383),Z=function(e){var t=e.selectedSession,n=e.currentUserUID,o=e.otherUserUID,i=e.closeShareChat,l=(0,s.useState)([]),u=(0,r.Z)(l,2),h=u[0],x=u[1],v=(0,s.useState)(!0),m=(0,r.Z)(v,2),g=m[0],w=m[1],j=(0,s.useState)(null),Z=(0,r.Z)(j,2),y=Z[0],C=Z[1],U=(0,s.useState)(null),N=(0,r.Z)(U,2),S=N[0],L=N[1];return(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,p.JU)((0,p.hJ)(a.RZ,"expertApplications"),n),e.next=4,(0,p.QT)(t);case 4:r=e.sent,C(r.exists()?o:n),console.log("Determining selectedMessageUID:",{otherUserUID:o,currentUserUID:n,existsInExpertApplications:r.exists(),determinedMessageUID:r.exists()?o:n}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error determining selectedMessageUID:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();e()}),[n,o]),(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var n,r,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t||!y){e.next=11;break}return n=(0,p.hJ)(a.RZ,"users",y,"discussions",t,"messages"),console.log("Path for messagesCollectionRef:",n.path),e.next=6,(0,p.PL)((0,p.IO)(n,(0,p.Xo)("createTime")));case 6:r=e.sent,s=r.docs.map((function(e){var t=e.data();return{prompt:t.prompt,response:t.response}})),x(s),w(!1),console.log("Fetched messages for discussionId:",t,s);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Error fetching shared chat messages:",e.t0),w(!1);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}();e()}),[t,y]),(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,p.JU)(a.RZ,"userProfiles",o),e.next=4,(0,p.QT)(t);case 4:(n=e.sent).exists()&&L(n.data()),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Error fetching other user data:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();e()}),[o]),y?(0,c.jsx)("div",{className:"blurred-background",children:(0,c.jsxs)("div",{className:"white-box-chathistory",children:[(0,c.jsx)("div",{className:"go-back-svg go-back-svg-padding",children:(0,c.jsx)("button",{onClick:i,children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,color:"black",stroke:"currentColor",className:"w-6 h-6",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})}),S?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("p",{children:"Chat of:"}),(0,c.jsx)("h3",{children:S.displayName}),(0,c.jsx)("div",{className:"divider "})]}):(0,c.jsx)(k.Z,{}),(0,c.jsx)("div",{className:"shared-chat scroll-cat",children:g?(0,c.jsx)(k.Z,{}):h.map((function(e,t){return(0,c.jsxs)("div",{className:"chat-message",children:[(0,c.jsx)("strong",{children:(0,c.jsx)(b.U,{children:e.prompt})}),(0,c.jsx)(b.U,{children:e.response}),(0,c.jsx)("div",{className:"divider "})]},t)}))})]})}):null},y=n(276),C=(0,y.cF)(),U=(0,a.hJ)(a.db,"chats"),N=function(e,t){return e<t?"".concat(e,"_").concat(t):"".concat(t,"_").concat(e)},S=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n,r,s){var c,o,i,l,u,h,f,p;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=N(t,n),o=(0,a.JU)(U,c),e.next=5,(0,a.QT)(o);case 5:if(e.sent.exists()){e.next=9;break}return e.next=9,(0,a.pl)(o,{users:[t,n],createdAt:(0,a.Bt)()});case 9:if(!s){e.next=22;break}return i=(0,y.iH)(C,"chat_files/".concat(t,"/").concat(n,"/").concat(Date.now(),"_").concat(s.name)),e.next=13,(0,y.KV)(i,s);case 13:return e.next=15,(0,y.Jt)(i);case 15:return l=e.sent,u={text:r,file:{name:s.name,type:s.type,url:l},sender:t,receiver:n,timestamp:(0,a.Bt)(),isRead:!1},h=(0,a.hJ)(o,"messages"),e.next=20,(0,a.ET)(h,u);case 20:e.next=26;break;case 22:return f={text:r,sender:t,receiver:n,timestamp:(0,a.Bt)(),isRead:!1},p=(0,a.hJ)(o,"messages"),e.next=26,(0,a.ET)(p,f);case 26:return e.abrupt("return",!0);case 29:return e.prev=29,e.t0=e.catch(0),console.error("Error sending message:",e.t0),e.abrupt("return",!1);case 33:case"end":return e.stop()}}),e,null,[[0,29]])})));return function(t,n,r,s){return e.apply(this,arguments)}}(),L=function(e,t,n){try{var r=N(e,t),s=(0,a.JU)(U,r),c=(0,a.hJ)(s,"messages");(0,a.cf)(c,(function(e){try{var t=e.docs.map((function(e){return(0,u.Z)({id:e.id},e.data())})).sort((function(e,t){return t.timestamp-e.timestamp})).reverse();n(t)}catch(r){console.error("Error getting messages:",r),n([])}}))}catch(o){console.error("Error getting messages:",o),n([])}},M=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n,r){var s,c,o;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{s=N(t,n),c=(0,a.JU)(U,s),o=(0,a.hJ)(c,"messages"),r.forEach(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(n){var r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isRead||n.receiver!==t){e.next=5;break}return r=(0,a.JU)(o,n.id),e.next=4,(0,a.r7)(r,{isRead:!0});case 4:console.log("Message marked as read:",n.id);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}catch(i){console.error("Error marking messages as read:",i)}case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),E=function(e){var t=e.otherUserUID,n=(0,s.useState)([]),o=(0,r.Z)(n,2),i=o[0],l=o[1],u=(0,s.useRef)(null),h=(0,s.useRef)(null),p=(0,s.useState)(""),x=(0,r.Z)(p,2),v=x[0],m=x[1],g=(0,s.useState)(null),w=(0,r.Z)(g,2),j=w[0],b=w[1],k=(0,s.useState)(!1),Z=(0,r.Z)(k,2),y=Z[0],C=Z[1],U=(0,s.useState)("28px"),N=(0,r.Z)(U,2),E=N[0],I=N[1],z=(0,s.useState)(null),D=(0,r.Z)(z,2),J=D[0],H=D[1],T=(0,s.useRef)(null),R=(0,s.useState)(null),A=(0,r.Z)(R,2),B=(A[0],A[1]),V=(0,s.useState)(null),P=(0,r.Z)(V,2),W=P[0],O=P[1],Q=(0,s.useState)(!0),G=(0,r.Z)(Q,2);G[0],G[1];(0,s.useEffect)((function(){var e=(0,a.Aj)(a.I8,(function(e){b(e?e.uid:null)}));return function(){return e()}}),[]),(0,s.useEffect)((function(){C(j===t)}),[j,t]),(0,s.useEffect)((function(){j&&t&&L(j,t,(function(e){var t=e.slice(0).reverse();l(t),F()}))}),[j,t]),(0,s.useEffect)((function(){M(j,t)}),[j,t]);var _=window.innerWidth<=767;(0,s.useEffect)((function(){if(J&&J.type&&J.type.startsWith("image/")){var e=new FileReader;e.onload=function(e){B(e.target.result)},e.readAsDataURL(J)}else B(null)}),[J]);var q=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!y){e.next=6;break}return console.error("Cannot send messages to yourself."),console.log("currentUserUID:",j),console.log("otherUserUID:",t),e.abrupt("return");case 6:if(""!==v.trim()||J){e.next=8;break}return e.abrupt("return");case 8:if(!j||!t){e.next=15;break}return e.next=11,S(j,t,v,J);case 11:e.sent&&(m(""),H(null),B(null),_||h.current.focus()),e.next=16;break;case 15:console.error("currentUserUID or otherUserUID is undefined");case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),console.error("Error sending message:",e.t0);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}(),F=function(){u.current&&(u.current.scrollTop=u.current.scrollHeight)};(0,s.useEffect)((function(){F()}),[i]);var K=function(){var e=h.current;if(e){var t=Math.min(e.scrollHeight,200);I("".concat(t,"px"))}};(0,s.useEffect)((function(){K()}),[]);(0,s.useEffect)((function(){K()}),[]),(0,s.useEffect)((function(){""===v&&I("28px")}),[v]);var X=function(e){if(e){var t=e.toDate(),n=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0");return"".concat(n,":").concat(r)}return""},Y=function(){if(u.current){var e=u.current,t=e.scrollTop,n=(e.scrollHeight,e.clientHeight),r=Math.floor(t/n);if(r>=0&&r<i.length){var s=i[r];O(s.id)}}};return(0,s.useEffect)((function(){return u.current&&u.current.addEventListener("scroll",Y),function(){u.current&&u.current.removeEventListener("scroll",Y)}}),[u,i]),(0,s.useEffect)((function(){j&&t&&L(j,t,(function(e){var t=e.slice(0).reverse();l(t),F()}))}),[j,t]),(0,s.useEffect)((function(){M(j,t,i,W)}),[i,j,t,W]),(0,c.jsxs)("div",{className:"chat-column chat-column-video",children:[(0,c.jsx)("div",{className:"chat-box chat-box-video",ref:u,children:Array.isArray(i)&&i.length>0?i.map((function(e,t){return e.timestamp?(0,c.jsxs)("div",{className:e.sender===j?"chat-bubble user-sent":"chat-bubble",children:[(0,c.jsxs)("div",{className:"message",children:[e.file&&e.file.type&&e.file.type.startsWith("image/")?(0,c.jsx)("img",{src:e.file.url,alt:"Image",className:"rounded-image"}):e.file&&(0,c.jsxs)("div",{className:"file-container",children:[(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"})}),(0,c.jsx)("a",{href:e.file.url,target:"_blank",rel:"noopener noreferrer",children:e.file.name})]}),e.text&&(0,c.jsx)("p",{children:e.text})]}),(0,c.jsx)("div",{className:"timestamp small-timestamp ".concat(e.sender===j?"user-sent-timestamp":"other-sent-timestamp"),children:X(e.timestamp)})]},t):null})):(0,c.jsx)("div",{children:"No messages yet."})}),(0,c.jsxs)("div",{className:"chatui-container",children:[(0,c.jsx)("input",{type:"file",onChange:function(e){return function(e){var t=e.target.files[0];t&&(H(t),t.type&&t.type.startsWith("image/")?B(null):B({name:t.name,type:"file"}))}(e)},style:{display:"none"},ref:T}),(0,c.jsx)("button",{className:"userui-left-button",onClick:function(){return T.current.click()},children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"})})}),(0,c.jsx)("button",{"aria-label":"Send Message",onClick:q,className:" userui-right-button ",children:(0,c.jsx)("i",{className:"fas fa-paper-plane"})}),(0,c.jsx)("div",{id:"messageInputContainer",children:J&&(0,c.jsxs)("div",{className:"file-info",children:[J.type.startsWith("image/")&&(0,c.jsx)("div",{className:"image-preview-container",children:(0,c.jsx)("img",{src:URL.createObjectURL(new Blob([J],{type:J.type})),alt:"Image Preview",style:{maxWidth:"70%",height:"auto"}})}),!J.type.startsWith("image/")&&(0,c.jsxs)("div",{className:"file-details",children:[(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"})}),(0,c.jsx)("span",{children:J.name})]}),(0,c.jsx)("button",{className:"remove-button",onClick:function(){return H(null)},children:"X"})]})}),(0,c.jsx)("textarea",{type:"text",placeholder:"Type a message...",ref:h,style:{height:E},value:v,onChange:function(e){m(e.target.value),K()},onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),q())},className:"message-input scroll-col",autoComplete:"off",inputMode:"text"})]})]})},I=function(e){var t=e.currentUserUID,n=e.otherUserUID,o=e.onClose,i=e.userData,u=(0,s.useRef)(null),h=(0,s.useRef)(null),x=(0,s.useState)(null),v=(0,r.Z)(x,2),m=v[0],g=v[1],w=(0,s.useState)(null),j=(0,r.Z)(w,2),b=j[0],k=j[1],Z=(0,s.useState)(null),y=(0,r.Z)(Z,2),C=y[0],U=y[1],N=(0,s.useState)(null),S=(0,r.Z)(N,2),L=S[0],M=S[1],I=(0,s.useState)(!1),z=(0,r.Z)(I,2),D=(z[0],z[1]),J=(0,s.useState)(!1),H=(0,r.Z)(J,2),T=(H[0],H[1]),R=(0,s.useState)(""),A=(0,r.Z)(R,2),B=A[0],V=A[1],P=(0,s.useState)(""),W=(0,r.Z)(P,2),O=W[0],Q=(W[1],(0,s.useState)(!1)),G=(0,r.Z)(Q,2),_=(G[0],G[1]),q=(0,s.useState)(!1),F=(0,r.Z)(q,2),K=F[0],X=F[1],Y=(0,s.useState)(!1),$=(0,r.Z)(Y,2),ee=$[0],te=$[1],ne=(0,s.useState)(!1),re=(0,r.Z)(ne,2),se=re[0],ae=re[1],ce=(0,s.useState)(!0),oe=(0,r.Z)(ce,2),ie=oe[0],le=oe[1],ue=(0,s.useState)(!1),de=(0,r.Z)(ue,2),he=de[0],fe=de[1],pe=(0,s.useState)(null),xe=(0,r.Z)(pe,2),ve=xe[0],me=xe[1],ge=(0,s.useState)(!1),we=(0,r.Z)(ge,2),je=we[0],be=we[1],ke=(0,s.useState)(!1),Ze=(0,r.Z)(ke,2),ye=(Ze[0],Ze[1],(0,s.useState)(!1)),Ce=(0,r.Z)(ye,2),Ue=Ce[0],Ne=Ce[1],Se=null,Le={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302"]},{urls:"turn:standard.relay.metered.ca:80",username:"9f24237eef08d63be9f50c85",credential:"bcSTypx8qHWJ7hH9"},{urls:"turn:standard.relay.metered.ca:80?transport=tcp",username:"9f24237eef08d63be9f50c85",credential:"bcSTypx8qHWJ7hH9"},{urls:"turn:standard.relay.metered.ca:443",username:"9f24237eef08d63be9f50c85",credential:"bcSTypx8qHWJ7hH9"},{urls:"turns:standard.relay.metered.ca:443?transport=tcp",username:"9f24237eef08d63be9f50c85",credential:"bcSTypx8qHWJ7hH9"}],iceCandidatePoolSize:10};(0,s.useEffect)((function(){var e=a.I8.onAuthStateChanged((function(e){me(e||null)}));return function(){return e()}}),[]),(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:t=e.sent,u.current&&(u.current.srcObject=t),k(t),U(new MediaStream),h.current&&(h.current.srcObject=C),u.current&&u.current.srcObject&&console.log("Stream:",u.current.srcObject),ae(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){Ie()}}),[t,n]),(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,p.JU)((0,p.hJ)(a.db,"rooms"),B),e.next=3,(0,p.QT)(t);case 3:n=e.sent,_(n.exists());case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();B&&e()}),[B]),(0,s.useEffect)((function(){var e=(0,p.hJ)(a.db,"rooms"),r=(0,p.cf)(e,(function(e){e.docChanges().forEach((function(e){if("added"===e.type){e.doc.data();var r=e.doc.id;r==="".concat(t,"_").concat(n)&&(X(!0),M(r),te(!0))}}))}));return function(){return r()}}),[t,n]);var Me=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var r,s,c,o,i,u,x,v,m;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(n,"_").concat(t),D(!0),s=(0,p.JU)((0,p.hJ)(a.db,"rooms"),r),c=new RTCPeerConnection(Le),g(c),De(c),b.getTracks().forEach((function(e){c.addTrack(e,b)})),o=(0,p.JU)(a.db,"videoCallStatus",r),e.next=10,(0,p.QT)(o);case 10:if(e.sent.exists()){e.next=16;break}return e.next=14,(0,p.pl)(o,(i={},(0,l.Z)(i,t,{isEnabled:!0}),(0,l.Z)(i,n,{isEnabled:!0}),i));case 14:e.next=18;break;case 16:return e.next=18,(0,p.r7)(o,(u={},(0,l.Z)(u,t,{isEnabled:!0}),(0,l.Z)(u,n,{isEnabled:!0}),u),{merge:!0});case 18:return x=(0,p.hJ)(a.db,"rooms",s.id,"callerCandidates"),c.addEventListener("icecandidate",(function(e){e.candidate?(console.log("Got candidate: ",e.candidate),"closed"!==c.signalingState&&(0,p.pl)((0,p.JU)(x),e.candidate.toJSON())):console.log("Got final candidate!")})),e.next=22,c.createOffer();case 22:return v=e.sent,e.next=25,c.setLocalDescription(v);case 25:return console.log("Created offer:",v),m={offer:{type:v.type,sdp:v.sdp},name:O},e.next=29,(0,p.pl)(s,m);case 29:M(s.id),console.log("New room created with SDP offer. Room ID: ".concat(s.id)),h.current.srcObject=C,c.addEventListener("track",(function(e){console.log("Got remote track:",e.streams[0]),e.streams[0].getTracks().forEach((function(e){console.log("Add a track to the remoteStream:",e),C.addTrack(e)}))})),(0,p.cf)(s,function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.data(),c.currentRemoteDescription||!n||!n.answer){e.next=6;break}return console.log("Got remote description: ",n.answer),r=new RTCSessionDescription(n.answer),e.next=6,c.setRemoteDescription(r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Se=(0,p.cf)((0,p.hJ)(a.db,"rooms",s.id,"calleeCandidates"),(function(e){e.docChanges().forEach(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("added"!==t.type){e.next=7;break}if(be(!0),n=t.doc.data(),console.log("Got new remote ICE candidate: ".concat(JSON.stringify(n))),"closed"===c.signalingState){e.next=7;break}return e.next=7,c.addIceCandidate(new RTCIceCandidate(n));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),fe(!0),b.getVideoTracks()[0].enabled=!0,ae(!0);case 38:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ee=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var r,s,c,o,i,l,u,x,v;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r="".concat(t,"_").concat(n))){e.next=40;break}return T(!0),s=(0,p.JU)((0,p.hJ)(a.db,"rooms"),r),e.next=6,(0,p.QT)(s);case 6:if(!(c=e.sent).exists()){e.next=36;break}return console.log("Got room:",c.data()),console.log("Create PeerConnection with configuration: ",Le),o=new RTCPeerConnection(Le),g(o),De(o),b.getTracks().forEach((function(e){o.addTrack(e,b)})),i=(0,p.hJ)(a.db,"rooms",r,"calleeCandidates"),o.addEventListener("icecandidate",(function(e){e.candidate?(console.log("Got candidate: ",e.candidate),(0,p.pl)((0,p.JU)(i),e.candidate.toJSON())):console.log("Got final candidate!")})),h.current.srcObject=C,o.addEventListener("track",(function(e){console.log("Got remote track:",e.streams[0]),e.streams[0].getTracks().forEach((function(e){console.log("Add a track to the remoteStream:",e),C.addTrack(e)}))})),l=c.data().offer,console.log("Got offer:",l),e.next=22,o.setRemoteDescription(new RTCSessionDescription(l));case 22:return e.next=24,o.createAnswer();case 24:return u=e.sent,console.log("Created answer:",u),e.next=28,o.setLocalDescription(u);case 28:return x={answer:{type:u.type,sdp:u.sdp}},e.next=31,(0,p.pl)(s,x,{merge:!0});case 31:v=(0,p.hJ)(a.db,"rooms",r,"callerCandidates"),(0,p.cf)(v,(function(e){e.docChanges().forEach(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("added"!==t.type){e.next=6;break}if(n=t.doc.data(),console.log("Got new remote ICE candidate: ".concat(JSON.stringify(n))),"closed"===o.signalingState){e.next=6;break}return e.next=6,o.addIceCandidate(new RTCIceCandidate(n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),X(!1),e.next=38;break;case 36:console.log("Room not found"),T(!1);case 38:e.next=41;break;case 40:console.error("Invalid room ID");case 41:fe(!0),ae(!0),be(!0);case 44:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b&&b.getTracks().forEach((function(e){e.stop()})),C&&C.getTracks().forEach((function(e){return e.stop()})),!L){e.next=17;break}return e.next=5,(0,p.PL)((0,p.hJ)(a.db,"rooms",L,"calleeCandidates"));case 5:return e.sent.forEach(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.oe)(t.ref);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,(0,p.PL)((0,p.hJ)(a.db,"rooms",L,"callerCandidates"));case 9:return e.sent.forEach(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.oe)(t.ref);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t=(0,p.JU)((0,p.hJ)(a.db,"rooms"),L),e.next=14,(0,p.oe)(t);case 14:return n=(0,p.JU)(a.db,"videoCallStatus",L),e.next=17,(0,p.oe)(n);case 17:m&&m.close(),u.current&&(u.current.srcObject=null,r=(null===ve||void 0===ve?void 0:ve.photoURL)||"default-profile-picture.png",u.current.poster=r),h.current&&(h.current.srcObject=null),h.current&&(h.current.srcObject=null),Se&&Se(),D(!1),T(!1),M(null),V(""),ae(!1);case 28:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ze=function(){Ie(),o()},De=function(e){e.addEventListener("icegatheringstatechange",(function(){console.log("ICE gathering state changed: ".concat(e.iceGatheringState))})),e.addEventListener("connectionstatechange",(function(){console.log("Connection state change: ".concat(e.connectionState))})),e.addEventListener("signalingstatechange",(function(){console.log("Signaling state change: ".concat(e.signalingState))})),e.addEventListener("iceconnectionstatechange ",(function(){console.log("ICE connection state change: ".concat(e.iceConnectionState))}))},Je=function(){b&&(b.getAudioTracks()[0].enabled=!b.getAudioTracks()[0].enabled,le(!ie))},He=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var r,s,c,o;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!b){e.next=17;break}return(r=b.getVideoTracks()[0]).enabled=!r.enabled,ae(!se),s=(0,p.JU)(a.db,"videoCallStatus",L),e.next=7,(0,p.QT)(s);case 7:if(!e.sent.exists()){e.next=13;break}return e.next=11,(0,p.r7)(s,(0,l.Z)({},t,{isEnabled:r.enabled}),{merge:!0});case 11:e.next=15;break;case 13:return e.next=15,(0,p.pl)(s,(c={},(0,l.Z)(c,t,{isEnabled:r.enabled}),(0,l.Z)(c,n,{isEnabled:!1}),c));case 15:o=u.current,r.enabled?o.srcObject=b:o.srcObject=null;case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){if(L&&n){var e=(0,p.JU)(a.db,"videoCallStatus",L),t=(0,p.cf)(e,(function(e){if(e.exists()){var t=e.data()[n];t&&t.isEnabled&&C.getTracks().length>0?be(!0):be(!1)}else be(!1)}),(function(e){console.log("Error listening to user status document:",e)}));return function(){return t()}}}),[L,n,C]);var Te=window.innerWidth<=768;return(0,c.jsxs)("div",{className:"video-chat",children:[(0,c.jsxs)("div",{className:"video-chat-header d-none-mobile",children:[(0,c.jsx)("h2",{className:"fw-bold lead mb-3",style:{fontSize:"2rem"},children:i.displayName}),(0,c.jsx)("div",{className:"video-go-back-svg",children:(0,c.jsx)("button",{onClick:o,children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]}),(0,c.jsxs)("div",{className:"video-chat-container",children:[(0,c.jsx)("div",{className:"chat-container-call ".concat(Ue?"show":""),children:Ue&&(0,c.jsx)(E,{currentUserUID:t,otherUserUID:n})}),(0,c.jsxs)("div",{className:"video-row",children:[Te&&(0,c.jsx)("div",{className:"mobile-go-back-svg",children:(0,c.jsx)("svg",{onClick:function(){o()},xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"white",height:"45",width:"25",style:{margin:"5px"},children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),(0,c.jsx)("video",{className:"local-video",ref:u,autoPlay:!0,playsInline:!0,muted:!0,style:{display:se?"block":"none"}}),!se&&!Te&&(0,c.jsx)("div",{className:"profile-picture-container",children:(0,c.jsx)("img",{className:"profile-picture",src:(null===ve||void 0===ve?void 0:ve.photoURL)||"default-profile-picture.png",alt:"Profile Picture"})}),(0,c.jsx)("video",{className:"remote-video",ref:h,autoPlay:!0,playsInline:!0,style:{display:je?"block":"none"}}),!je&&(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("div",{className:"profile-picture-container",children:[Te&&(0,c.jsx)("p",{style:{textAlign:"center"},children:null===i||void 0===i?void 0:i.displayName}),(0,c.jsx)("img",{className:"profile-picture",src:i.photoURL||"default-profile-picture.png",alt:"Profile Picture"})]})})]}),(0,c.jsxs)("div",{className:"name-row d-none-mobile ",children:[(0,c.jsx)("p",{children:null===ve||void 0===ve?void 0:ve.displayName}),(0,c.jsx)("p",{children:i.displayName})]})]}),!Te&&(0,c.jsx)("div",{className:"video-chat-footer",children:(0,c.jsxs)("div",{className:"video-input-container",children:[(0,c.jsx)("button",{className:"settings-button",onClick:Je,children:ie?(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"})]}):(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"})]})}),(0,c.jsx)("button",{className:"settings-button ",onClick:He,children:se?(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M21 6.5l-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73 3.27 2z"})]}):(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"})]})}),!he&&!ee&&!L&&(0,c.jsx)("button",{className:"create-room-button",onClick:function(){b&&(ae(!0),Me())},children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"})]})}),!he&&K&&(0,c.jsx)("button",{className:"join-room-button",onClick:function(){return Ee(be(!0))},children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M23.71 16.67C20.66 13.78 16.54 12 12 12 7.46 12 3.34 13.78.29 16.67c-.18.18-.29.43-.29.71 0 .28.11.53.29.71l2.48 2.48c.18.18.43.29.71.29.27 0 .52-.11.7-.28.79-.74 1.69-1.36 2.66-1.85.33-.16.56-.5.56-.9v-3.1c1.45-.48 3-.73 4.6-.73s3.15.25 4.6.72v3.1c0 .39.23.74.56.9.98.49 1.87 1.12 2.66 1.85.18.18.43.28.7.28.28 0 .53-.11.71-.29l2.48-2.48c.18-.18.29-.43.29-.71 0-.27-.11-.52-.29-.7zM21.16 6.26l-1.41-1.41-3.56 3.55 1.41 1.41s3.45-3.52 3.56-3.55zM13 2h-2v5h2V2zM6.4 9.81L7.81 8.4 4.26 4.84 2.84 6.26c.11.03 3.56 3.55 3.56 3.55z"})]})}),he&&m&&(0,c.jsx)("button",{className:"hang-up-button",onClick:ze,children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"})]})}),(0,c.jsx)("div",{className:"settings-button-container",children:(0,c.jsx)("button",{className:"settings-button",onClick:function(){return Ne(!Ue)},children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 0 1-.923 1.785A5.969 5.969 0 0 0 6 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337Z"})})})})]})}),Te&&(0,c.jsx)("div",{className:"video-chat-footer-mobile",children:(0,c.jsx)("div",{className:"video-chat-footer",children:(0,c.jsxs)("div",{className:"video-input-container",children:[(0,c.jsx)("button",{className:"settings-button ",onClick:He,children:se?(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M21 6.5l-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73 3.27 2z"})]}):(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"})]})}),!he&&!ee&&!L&&(0,c.jsx)("button",{className:"create-room-button",onClick:function(){b&&Me()},children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"})]})}),!he&&K&&(0,c.jsx)("button",{className:"join-room-button",onClick:Ee,children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M23.71 16.67C20.66 13.78 16.54 12 12 12 7.46 12 3.34 13.78.29 16.67c-.18.18-.29.43-.29.71 0 .28.11.53.29.71l2.48 2.48c.18.18.43.29.71.29.27 0 .52-.11.7-.28.79-.74 1.69-1.36 2.66-1.85.33-.16.56-.5.56-.9v-3.1c1.45-.48 3-.73 4.6-.73s3.15.25 4.6.72v3.1c0 .39.23.74.56.9.98.49 1.87 1.12 2.66 1.85.18.18.43.28.7.28.28 0 .53-.11.71-.29l2.48-2.48c.18-.18.29-.43.29-.71 0-.27-.11-.52-.29-.7zM21.16 6.26l-1.41-1.41-3.56 3.55 1.41 1.41s3.45-3.52 3.56-3.55zM13 2h-2v5h2V2zM6.4 9.81L7.81 8.4 4.26 4.84 2.84 6.26c.11.03 3.56 3.55 3.56 3.55z"})]})}),he&&m&&(0,c.jsx)("button",{className:"hang-up-button",onClick:ze,children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"})]})}),(0,c.jsx)("button",{className:"settings-button",onClick:Je,children:ie?(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"})]}):(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"})]})})]})})})]})},z=function(e){var t=e.currentUserUID,n=e.otherUserUID,o=e.onClose,i=e.userData,u=(0,s.useRef)(null),h=(0,s.useRef)(null),x=(0,s.useState)(null),v=(0,r.Z)(x,2),m=v[0],g=v[1],w=(0,s.useState)(null),j=(0,r.Z)(w,2),b=j[0],k=j[1],Z=(0,s.useState)(null),y=(0,r.Z)(Z,2),C=y[0],U=y[1],N=(0,s.useState)(null),S=(0,r.Z)(N,2),L=S[0],M=S[1],I=(0,s.useState)(!1),z=(0,r.Z)(I,2),D=(z[0],z[1]),J=(0,s.useState)(!1),H=(0,r.Z)(J,2),T=(H[0],H[1]),R=(0,s.useState)(""),A=(0,r.Z)(R,2),B=A[0],V=A[1],P=(0,s.useState)(""),W=(0,r.Z)(P,2),O=W[0],Q=(W[1],(0,s.useState)(!1)),G=(0,r.Z)(Q,2),_=(G[0],G[1]),q=(0,s.useState)(!1),F=(0,r.Z)(q,2),K=F[0],X=F[1],Y=(0,s.useState)(!1),$=(0,r.Z)(Y,2),ee=$[0],te=$[1],ne=(0,s.useState)(!1),re=(0,r.Z)(ne,2),se=re[0],ae=re[1],ce=(0,s.useState)(!0),oe=(0,r.Z)(ce,2),ie=oe[0],le=oe[1],ue=(0,s.useState)(!1),de=(0,r.Z)(ue,2),he=de[0],fe=de[1],pe=(0,s.useState)(null),xe=(0,r.Z)(pe,2),ve=xe[0],me=xe[1],ge=(0,s.useState)(!1),we=(0,r.Z)(ge,2),je=we[0],be=we[1],ke=(0,s.useState)(!1),Ze=(0,r.Z)(ke,2),ye=(Ze[0],Ze[1],(0,s.useState)(!1)),Ce=(0,r.Z)(ye,2),Ue=Ce[0],Ne=Ce[1],Se=null,Le={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302"]},{urls:"turn:standard.relay.metered.ca:80",username:"9f24237eef08d63be9f50c85",credential:"bcSTypx8qHWJ7hH9"},{urls:"turn:standard.relay.metered.ca:80?transport=tcp",username:"9f24237eef08d63be9f50c85",credential:"bcSTypx8qHWJ7hH9"},{urls:"turn:standard.relay.metered.ca:443",username:"9f24237eef08d63be9f50c85",credential:"bcSTypx8qHWJ7hH9"},{urls:"turns:standard.relay.metered.ca:443?transport=tcp",username:"9f24237eef08d63be9f50c85",credential:"bcSTypx8qHWJ7hH9"}],iceCandidatePoolSize:10};(0,s.useEffect)((function(){var e=a.I8.onAuthStateChanged((function(e){me(e||null)}));return function(){return e()}}),[]),(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:t=e.sent,u.current.srcObject=t,k(t),U(new MediaStream),h.current.srcObject=C,console.log("Stream:",u.current.srcObject),ae(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){Ie()}}),[t,n]),(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,p.JU)((0,p.hJ)(a.db,"calls"),B),e.next=3,(0,p.QT)(t);case 3:n=e.sent,_(n.exists());case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();B&&e()}),[B]),(0,s.useEffect)((function(){var e=(0,p.hJ)(a.db,"calls"),r=(0,p.cf)(e,(function(e){e.docChanges().forEach((function(e){if("added"===e.type){e.doc.data();var r=e.doc.id;r==="".concat(t,"_").concat(n)&&(X(!0),M(r),te(!0))}}))}));return function(){return r()}}),[t,n]);var Me=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var r,s,c,o,i,u,x,v,m;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(n,"_").concat(t),D(!0),s=(0,p.JU)((0,p.hJ)(a.db,"calls"),r),c=new RTCPeerConnection(Le),g(c),ze(c),b.getTracks().forEach((function(e){c.addTrack(e,b)})),o=(0,p.JU)(a.db,"videoCallStatus",r),e.next=10,(0,p.QT)(o);case 10:if(e.sent.exists()){e.next=16;break}return e.next=14,(0,p.pl)(o,(i={},(0,l.Z)(i,t,{isEnabled:!1}),(0,l.Z)(i,n,{isEnabled:!1}),i));case 14:e.next=18;break;case 16:return e.next=18,(0,p.r7)(o,(u={},(0,l.Z)(u,t,{isEnabled:!1}),(0,l.Z)(u,n,{isEnabled:!1}),u),{merge:!0});case 18:return x=(0,p.hJ)(a.db,"calls",s.id,"callerCandidates"),c.addEventListener("icecandidate",(function(e){e.candidate?(console.log("Got candidate: ",e.candidate),"closed"!==c.signalingState&&(0,p.pl)((0,p.JU)(x),e.candidate.toJSON())):console.log("Got final candidate!")})),e.next=22,c.createOffer();case 22:return v=e.sent,e.next=25,c.setLocalDescription(v);case 25:return console.log("Created offer:",v),m={offer:{type:v.type,sdp:v.sdp},name:O},e.next=29,(0,p.pl)(s,m);case 29:M(s.id),console.log("New room created with SDP offer. Room ID: ".concat(s.id)),h.current.srcObject=C,c.addEventListener("track",(function(e){console.log("Got remote track:",e.streams[0]),e.streams[0].getTracks().forEach((function(e){console.log("Add a track to the remoteStream:",e),C.addTrack(e)}))})),(0,p.cf)(s,function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.data(),c.currentRemoteDescription||!n||!n.answer){e.next=6;break}return console.log("Got remote description: ",n.answer),r=new RTCSessionDescription(n.answer),e.next=6,c.setRemoteDescription(r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Se=(0,p.cf)((0,p.hJ)(a.db,"calls",s.id,"calleeCandidates"),(function(e){e.docChanges().forEach(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("added"!==t.type){e.next=6;break}if(n=t.doc.data(),console.log("Got new remote ICE candidate: ".concat(JSON.stringify(n))),"closed"===c.signalingState){e.next=6;break}return e.next=6,c.addIceCandidate(new RTCIceCandidate(n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),fe(!0),b.getVideoTracks()[0].enabled=!1,ae(!1);case 38:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ee=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var r,s,c,o,i,l,u,x,v;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r="".concat(t,"_").concat(n))){e.next=40;break}return T(!0),s=(0,p.JU)((0,p.hJ)(a.db,"calls"),r),e.next=6,(0,p.QT)(s);case 6:if(!(c=e.sent).exists()){e.next=36;break}return console.log("Got room:",c.data()),console.log("Create PeerConnection with configuration: ",Le),o=new RTCPeerConnection(Le),g(o),ze(o),b.getTracks().forEach((function(e){o.addTrack(e,b)})),i=(0,p.hJ)(a.db,"calls",r,"calleeCandidates"),o.addEventListener("icecandidate",(function(e){e.candidate?(console.log("Got candidate: ",e.candidate),(0,p.pl)((0,p.JU)(i),e.candidate.toJSON())):console.log("Got final candidate!")})),h.current.srcObject=C,o.addEventListener("track",(function(e){console.log("Got remote track:",e.streams[0]),e.streams[0].getTracks().forEach((function(e){console.log("Add a track to the remoteStream:",e),C.addTrack(e)}))})),l=c.data().offer,console.log("Got offer:",l),e.next=22,o.setRemoteDescription(new RTCSessionDescription(l));case 22:return e.next=24,o.createAnswer();case 24:return u=e.sent,console.log("Created answer:",u),e.next=28,o.setLocalDescription(u);case 28:return x={answer:{type:u.type,sdp:u.sdp}},e.next=31,(0,p.pl)(s,x,{merge:!0});case 31:v=(0,p.hJ)(a.db,"calls",r,"callerCandidates"),(0,p.cf)(v,(function(e){e.docChanges().forEach(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("added"!==t.type){e.next=6;break}if(n=t.doc.data(),console.log("Got new remote ICE candidate: ".concat(JSON.stringify(n))),"closed"===o.signalingState){e.next=6;break}return e.next=6,o.addIceCandidate(new RTCIceCandidate(n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),X(!1),e.next=38;break;case 36:console.log("Room not found"),T(!1);case 38:e.next=41;break;case 40:console.error("Invalid room ID");case 41:fe(!0),be(!1),b.getVideoTracks()[0].enabled=!1,ae(!1);case 45:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b&&b.getTracks().forEach((function(e){e.stop()})),C&&C.getTracks().forEach((function(e){return e.stop()})),!L){e.next=17;break}return e.next=5,(0,p.PL)((0,p.hJ)(a.db,"calls",L,"calleeCandidates"));case 5:return e.sent.forEach(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.oe)(t.ref);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,(0,p.PL)((0,p.hJ)(a.db,"calls",L,"callerCandidates"));case 9:return e.sent.forEach(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.oe)(t.ref);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t=(0,p.JU)((0,p.hJ)(a.db,"calls"),L),e.next=14,(0,p.oe)(t);case 14:return n=(0,p.JU)(a.db,"videoCallStatus",L),e.next=17,(0,p.oe)(n);case 17:m&&m.close(),u.current&&(u.current.srcObject=null,r=(null===ve||void 0===ve?void 0:ve.photoURL)||"default-profile-picture.png",u.current.poster=r),h.current&&(h.current.srcObject=null),h.current&&(h.current.srcObject=null),Se&&Se(),D(!1),T(!1),M(null),V(""),ae(!1);case 28:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ze=function(e){e.addEventListener("icegatheringstatechange",(function(){console.log("ICE gathering state changed: ".concat(e.iceGatheringState))})),e.addEventListener("connectionstatechange",(function(){console.log("Connection state change: ".concat(e.connectionState))})),e.addEventListener("signalingstatechange",(function(){console.log("Signaling state change: ".concat(e.signalingState))})),e.addEventListener("iceconnectionstatechange ",(function(){console.log("ICE connection state change: ".concat(e.iceConnectionState))}))},De=function(){b&&(b.getAudioTracks()[0].enabled=!b.getAudioTracks()[0].enabled,le(!ie))},Je=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var r,s,c,o;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!b){e.next=17;break}return(r=b.getVideoTracks()[0]).enabled=!r.enabled,ae(!se),s=(0,p.JU)(a.db,"videoCallStatus",L),e.next=7,(0,p.QT)(s);case 7:if(!e.sent.exists()){e.next=13;break}return e.next=11,(0,p.r7)(s,(0,l.Z)({},t,{isEnabled:r.enabled}),{merge:!0});case 11:e.next=15;break;case 13:return e.next=15,(0,p.pl)(s,(c={},(0,l.Z)(c,t,{isEnabled:r.enabled}),(0,l.Z)(c,n,{isEnabled:!1}),c));case 15:o=u.current,r.enabled?o.srcObject=b:o.srcObject=null;case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){if(L&&n){var e=(0,p.JU)(a.db,"videoCallStatus",L),t=(0,p.cf)(e,(function(e){if(e.exists()){var t=e.data()[n];t&&t.isEnabled&&C.getTracks().length>0?be(!0):be(!1)}else be(!1)}),(function(e){console.log("Error listening to user status document:",e)}));return function(){return t()}}}),[L,n,C]);var He=window.innerWidth<=768,Te=function(){Ie(),o()};return(0,c.jsxs)("div",{className:"video-chat",children:[(0,c.jsxs)("div",{className:"video-chat-header d-none-mobile",children:[(0,c.jsx)("h2",{className:"fw-bold lead mb-3",style:{fontSize:"2rem"},children:i.displayName}),(0,c.jsx)("div",{className:"video-go-back-svg",children:(0,c.jsx)("button",{onClick:o,children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]}),(0,c.jsxs)("div",{className:"video-chat-container",children:[(0,c.jsx)("div",{className:"chat-container-call ".concat(Ue?"show":""),children:Ue&&(0,c.jsx)(E,{currentUserUID:t,otherUserUID:n})}),(0,c.jsxs)("div",{className:"video-row",children:[He&&(0,c.jsx)("div",{className:"mobile-go-back-svg",children:(0,c.jsx)("svg",{onClick:function(){o()},xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"white",height:"45",width:"25",style:{margin:"5px"},children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),(0,c.jsx)("video",{className:"local-video",ref:u,muted:!0,autoPlay:!0,playsInline:!0,style:{display:se?"block":"none"}}),!se&&!He&&(0,c.jsx)("div",{className:"profile-picture-container ",children:(0,c.jsx)("img",{className:"profile-picture",src:(null===ve||void 0===ve?void 0:ve.photoURL)||"default-profile-picture.png",alt:"Profile Picture"})}),(0,c.jsx)("video",{className:"remote-video",ref:h,autoPlay:!0,playsInline:!0,style:{display:je?"block":"none"}}),!je&&(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("div",{className:"profile-picture-container ",children:[He&&(0,c.jsx)("p",{style:{textAlign:"center"},children:null===i||void 0===i?void 0:i.displayName}),(0,c.jsx)("img",{className:"profile-picture",src:i.photoURL||"default-profile-picture.png",alt:"Profile Picture"})]})})]}),(0,c.jsxs)("div",{className:"name-row d-none-mobile ",children:[(0,c.jsx)("p",{children:null===ve||void 0===ve?void 0:ve.displayName}),(0,c.jsx)("p",{children:i.displayName})]})]}),!He&&(0,c.jsx)("div",{className:"video-chat-footer",children:(0,c.jsxs)("div",{className:"video-input-container",children:[(0,c.jsx)("button",{className:"settings-button",onClick:De,children:ie?(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"})]}):(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"})]})}),(0,c.jsx)("button",{className:"settings-button ",onClick:Je,children:se?(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M21 6.5l-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73 3.27 2z"})]}):(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"})]})}),!he&&!ee&&!L&&(0,c.jsx)("button",{className:"create-room-button",onClick:function(){b&&Me()},children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"})]})}),!he&&K&&(0,c.jsx)("button",{className:"join-room-button",onClick:function(){return Ee()},children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M23.71 16.67C20.66 13.78 16.54 12 12 12 7.46 12 3.34 13.78.29 16.67c-.18.18-.29.43-.29.71 0 .28.11.53.29.71l2.48 2.48c.18.18.43.29.71.29.27 0 .52-.11.7-.28.79-.74 1.69-1.36 2.66-1.85.33-.16.56-.5.56-.9v-3.1c1.45-.48 3-.73 4.6-.73s3.15.25 4.6.72v3.1c0 .39.23.74.56.9.98.49 1.87 1.12 2.66 1.85.18.18.43.28.7.28.28 0 .53-.11.71-.29l2.48-2.48c.18-.18.29-.43.29-.71 0-.27-.11-.52-.29-.7zM21.16 6.26l-1.41-1.41-3.56 3.55 1.41 1.41s3.45-3.52 3.56-3.55zM13 2h-2v5h2V2zM6.4 9.81L7.81 8.4 4.26 4.84 2.84 6.26c.11.03 3.56 3.55 3.56 3.55z"})]})}),he&&m&&(0,c.jsx)("button",{className:"hang-up-button",onClick:Te,children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"})]})}),(0,c.jsx)("div",{className:"settings-button-container",children:(0,c.jsx)("button",{className:"settings-button",onClick:function(){return Ne(!Ue)},children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"white",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 0 1-.923 1.785A5.969 5.969 0 0 0 6 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337Z"})})})})]})}),He&&(0,c.jsx)("div",{className:"video-chat-footer-mobile",children:(0,c.jsx)("div",{className:"video-chat-footer",children:(0,c.jsxs)("div",{className:"video-input-container",children:[(0,c.jsx)("button",{className:"settings-button ",onClick:Je,children:se?(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M21 6.5l-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73 3.27 2z"})]}):(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"})]})}),!he&&!ee&&!L&&(0,c.jsx)("button",{className:"create-room-button",onClick:function(){b&&Me()},children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"})]})}),!he&&K&&(0,c.jsx)("button",{className:"join-room-button",onClick:Ee,children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M23.71 16.67C20.66 13.78 16.54 12 12 12 7.46 12 3.34 13.78.29 16.67c-.18.18-.29.43-.29.71 0 .28.11.53.29.71l2.48 2.48c.18.18.43.29.71.29.27 0 .52-.11.7-.28.79-.74 1.69-1.36 2.66-1.85.33-.16.56-.5.56-.9v-3.1c1.45-.48 3-.73 4.6-.73s3.15.25 4.6.72v3.1c0 .39.23.74.56.9.98.49 1.87 1.12 2.66 1.85.18.18.43.28.7.28.28 0 .53-.11.71-.29l2.48-2.48c.18-.18.29-.43.29-.71 0-.27-.11-.52-.29-.7zM21.16 6.26l-1.41-1.41-3.56 3.55 1.41 1.41s3.45-3.52 3.56-3.55zM13 2h-2v5h2V2zM6.4 9.81L7.81 8.4 4.26 4.84 2.84 6.26c.11.03 3.56 3.55 3.56 3.55z"})]})}),he&&m&&(0,c.jsx)("button",{className:"hang-up-button",onClick:Te,children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"})]})}),(0,c.jsx)("button",{className:"settings-button",onClick:De,children:ie?(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"})]}):(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"32px",viewBox:"0 0 24 24",width:"32px",fill:"white",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),(0,c.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"})]})})]})})})]})},D=function(e){var t=e.toggleColumns,n=e.otherUserUID,o=e.currentUserUID,i=(0,s.useState)({isMobile:!1,photoURL:null,displayName:"",occupation:"",isShareChatOpen:!1,selectedSession:null,selectedMessageUID:null}),l=(0,r.Z)(i,2),h=l[0],x=l[1],v=(0,s.useState)(!1),m=(0,r.Z)(v,2),g=m[0],w=m[1],j=(0,s.useState)(null),b=(0,r.Z)(j,2),k=b[0],y=b[1],C=(0,s.useState)(!1),U=(0,r.Z)(C,2),N=U[0],S=U[1],L=(0,s.useState)(null),M=(0,r.Z)(L,2),E=M[0],D=M[1],J=(0,s.useState)(!1),H=(0,r.Z)(J,2),T=H[0],R=H[1],A=(0,s.useState)(!1),B=(0,r.Z)(A,2),V=B[0],P=B[1],W=function(){var e=document.querySelector(".video-chat-wrapper");g?(e.classList.remove("open"),e.classList.add("close"),setTimeout((function(){w(!1),e.classList.remove("close")}),500)):(R(!0),setTimeout((function(){e.classList.add("open"),w(!0)}),100))},O=function(){var e=document.querySelector(".video-call-wrapper");N?(e.classList.remove("open"),e.classList.add("close"),setTimeout((function(){S(!1),e.classList.remove("close")}),500)):(P(!0),setTimeout((function(){e.classList.add("open"),S(!0)}),100))};(0,s.useEffect)((function(){if(o&&n){var e="".concat(o,"_").concat(n),t=(0,p.JU)((0,p.hJ)(a.db,"rooms"),e),r=(0,p.cf)(t,(function(e){e.exists()?y({roomId:e.id,offer:e.data().offer}):y(null)}));return function(){return r()}}}),[o,n]),(0,s.useEffect)((function(){if(o&&n){var e="".concat(o,"_").concat(n),t=(0,p.JU)((0,p.hJ)(a.db,"calls"),e),r=(0,p.cf)(t,(function(e){e.exists()?D({roomId:e.id,offer:e.data().offer}):D(null)}));return function(){return r()}}}),[o,n]),(0,s.useEffect)((function(){var e=window.matchMedia("(max-width: 768px)");x((function(t){return(0,u.Z)((0,u.Z)({},t),{},{isMobile:e.matches})}));var t=function(){x((function(t){return(0,u.Z)((0,u.Z)({},t),{},{isMobile:e.matches})}))};return e.addListener(t),function(){e.removeListener(t)}}),[]);var Q=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var r,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,p.QT)((0,p.JU)(t,n));case 3:(r=e.sent).exists()&&(s=r.data())&&x((function(e){var t,n;return(0,u.Z)((0,u.Z)({},e),{},{photoURL:s.photoURL,displayName:null!==(t=s.displayName)&&void 0!==t?t:"",occupation:null!==(n=s.occupation)&&void 0!==n?n:""})})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error fetching user data:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,r,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!n){e.next=8;break}return t=a.db,r=(0,p.hJ)(t,"expertApplications"),e.next=6,(0,p.QT)((0,p.JU)(r,n));case 6:e.sent.exists()?Q(r):(s=(0,p.hJ)(t,"userProfiles"),Q(s));case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error fetching user data:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}();e()}),[n]),(0,s.useEffect)((function(){var e=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,r,s,c,i,l,h,f;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!n||!o){e.next=16;break}return t=a.db,r=(0,p.hJ)(t,"sharedConversations"),c=(0,p.hJ)(t,"expertApplications"),e.next=7,(0,p.QT)((0,p.JU)(c,o));case 7:return i=e.sent,s=i.exists()?"".concat(n,"_").concat(o):"".concat(o,"_").concat(n),l=(0,p.JU)(r,s),e.next=12,(0,p.QT)(l);case 12:(h=e.sent).exists()&&(f=h.data().selectedSession,x((function(e){return(0,u.Z)((0,u.Z)({},e),{},{selectedSession:f})}))),e.next=17;break;case 16:x((function(e){return(0,u.Z)((0,u.Z)({},e),{},{selectedMessageUID:null,selectedSession:null})}));case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),console.error("Error fetching and updating session:",e.t0);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(){return e.apply(this,arguments)}}();e()}),[n,o]);var G=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,r,s,c,o,i,l;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n){e.next=3;break}throw new Error("otherUserUID is undefined or null");case 3:return t=a.db,r=(0,p.hJ)(t,"expertApplications"),e.next=7,(0,p.QT)((0,p.JU)(r,n));case 7:if(!(s=e.sent).exists()){e.next=13;break}c=s.data().customURL,window.location.href="https://www.tioassist.io/expert/".concat(c),e.next=18;break;case 13:return o=(0,p.hJ)(t,"userProfiles"),e.next=16,(0,p.QT)((0,p.JU)(o,n));case 16:(i=e.sent).exists()&&(l=i.data().customURL,window.location.href="https://www.tioassist.io/user/".concat(l));case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),console.error("Error handling image click:",e.t0.message);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(){return e.apply(this,arguments)}}();return(0,c.jsxs)("div",{className:"chat-header",children:[(0,c.jsxs)("div",{className:"chat-header-one",children:[h.isMobile&&(0,c.jsx)("svg",{onClick:t,xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",style:{marginRight:"8px"},children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})}),(0,c.jsx)("div",{className:"small-avatar-mobile",onClick:G,children:(0,c.jsx)("img",{className:"small-avatar-mobile ",src:h.photoURL,alt:"Custom 404 Image",role:"button"})}),(0,c.jsx)("div",{className:"user-info",children:(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{className:"font-weight-bold mb-0",children:h.displayName}),(0,c.jsx)("p",{className:"text-sm text-muted",children:h.occupation})]})})]}),(0,c.jsxs)("div",{className:"chat-header-two",children:[(0,c.jsx)("div",{className:"svg-wrapper ".concat(E?"unread-svg-border":""),onClick:O,children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",id:"call",height:"25",width:"25",style:{margin:"5px"},children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"})})}),(0,c.jsx)("div",{className:"svg-wrapper ".concat(k?"unread-svg-border":""),onClick:W,children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",style:{margin:"5px"},id:"videocall",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"})})}),h.selectedSession?(0,c.jsx)("svg",{className:"render-chat",xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",onClick:function(){x((function(e){return(0,u.Z)((0,u.Z)({},e),{},{isShareChatOpen:!0})}))},children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08M15.75 18.75v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5A3.375 3.375 0 006.375 7.5H5.25m11.9-3.664A2.251 2.251 0 0015 2.25h-1.5a2.251 2.251 0 00-2.15 1.586m5.8 0c.065.21.1.433.1.664v.75h-6V4.5c0-.231.035-.454.1-.664M6.75 7.5H4.875c-.621 0-1.125.504-1.125 1.125v12c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V16.5a9 9 0 00-9-9z"})}):null,h.isShareChatOpen&&(0,c.jsx)(Z,{currentUserUID:o,selectedSession:h.selectedSession,otherUserUID:n,closeShareChat:function(){x((function(e){return(0,u.Z)((0,u.Z)({},e),{},{isShareChatOpen:!1})}))}})]}),(0,c.jsx)("div",{className:"video-chat-wrapper ".concat(T?"open":""),children:g&&(0,c.jsx)(I,{currentUserUID:o,otherUserUID:n,onClose:function(){W()},userData:h})}),(0,c.jsx)("div",{className:"video-call-wrapper ".concat(V?"open":""),children:N&&(0,c.jsx)(z,{currentUserUID:o,otherUserUID:n,onClose:function(){O()},userData:h})})]})},J=function(e){var t=e.isRightColumnVisible,n=e.toggleColumns,o=e.otherUserUID,i=(0,s.useState)([]),l=(0,r.Z)(i,2),u=l[0],h=l[1],p=(0,s.useRef)(null),x=(0,s.useRef)(null),v=(0,s.useState)(""),m=(0,r.Z)(v,2),g=m[0],w=m[1],j=(0,s.useState)(null),b=(0,r.Z)(j,2),k=b[0],Z=b[1],y=(0,s.useState)(!1),C=(0,r.Z)(y,2),U=C[0],N=C[1],E=(0,s.useState)("28px"),I=(0,r.Z)(E,2),z=I[0],J=I[1],H=(0,s.useState)(null),T=(0,r.Z)(H,2),R=T[0],A=T[1],B=(0,s.useRef)(null),V=(0,s.useState)(null),P=(0,r.Z)(V,2),W=(P[0],P[1]),O=(0,s.useState)(null),Q=(0,r.Z)(O,2),G=Q[0],_=Q[1],q=(0,s.useState)(!0),F=(0,r.Z)(q,2),K=F[0],X=F[1];(0,s.useEffect)((function(){var e=(0,a.Aj)(a.I8,(function(e){Z(e?e.uid:null)}));return function(){return e()}}),[]),(0,s.useEffect)((function(){N(k===o)}),[k,o]),(0,s.useEffect)((function(){k&&o&&L(k,o,(function(e){var t=e.slice(0).reverse();h(t),ee()}))}),[k,o]),(0,s.useEffect)((function(){M(k,o)}),[k,o]);var Y=window.innerWidth<=767;(0,s.useEffect)((function(){if(R&&R.type&&R.type.startsWith("image/")){var e=new FileReader;e.onload=function(e){W(e.target.result)},e.readAsDataURL(R)}else W(null)}),[R]);var $=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!U){e.next=6;break}return console.error("Cannot send messages to yourself."),console.log("currentUserUID:",k),console.log("otherUserUID:",o),e.abrupt("return");case 6:if(""!==g.trim()||R){e.next=8;break}return e.abrupt("return");case 8:if(!k||!o){e.next=15;break}return e.next=11,S(k,o,g,R);case 11:e.sent&&(w(""),A(null),W(null),Y||x.current.focus()),e.next=16;break;case 15:console.error("currentUserUID or otherUserUID is undefined");case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),console.error("Error sending message:",e.t0);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}(),ee=function(){p.current&&(p.current.scrollTop=p.current.scrollHeight)};(0,s.useEffect)((function(){ee()}),[u]);var te=function(){var e=x.current;if(e){var t=Math.min(e.scrollHeight,200);J("".concat(t,"px"))}};(0,s.useEffect)((function(){te()}),[]);(0,s.useEffect)((function(){te()}),[]),(0,s.useEffect)((function(){""===g&&J("28px")}),[g]);var ne=function(e){if(e){var t=e.toDate(),n=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0");return"".concat(n,":").concat(r)}return""},re=function(){if(p.current){var e=p.current,t=e.scrollTop,n=(e.scrollHeight,e.clientHeight),r=Math.floor(t/n);if(r>=0&&r<u.length){var s=u[r];_(s.id)}}};return(0,s.useEffect)((function(){return p.current&&p.current.addEventListener("scroll",re),function(){p.current&&p.current.removeEventListener("scroll",re)}}),[p,u]),(0,s.useEffect)((function(){k&&o&&L(k,o,(function(e){var t=e.slice(0).reverse();h(t),ee()}))}),[k,o]),(0,s.useEffect)((function(){M(k,o,u,G)}),[u,k,o,G]),(0,s.useEffect)((function(){t&&K&&X(!1)}),[t,K]),(0,c.jsxs)("div",{className:"chat-right ".concat(t&&!K?"slide-in":""),children:[(0,c.jsx)(D,{toggleColumns:n,otherUserUID:o,currentUserUID:k}),(0,c.jsxs)("div",{className:"chat-column",children:[(0,c.jsx)("div",{className:"chat-box",ref:p,children:Array.isArray(u)&&u.length>0?u.map((function(e,t){return e.timestamp?(0,c.jsxs)("div",{className:e.sender===k?"chat-bubble user-sent":"chat-bubble",children:[(0,c.jsxs)("div",{className:"message",children:[e.file&&e.file.type&&e.file.type.startsWith("image/")?(0,c.jsx)("img",{src:e.file.url,alt:"Image",className:"rounded-image"}):e.file&&(0,c.jsxs)("div",{className:"file-container",children:[(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"})}),(0,c.jsx)("a",{href:e.file.url,target:"_blank",rel:"noopener noreferrer",children:e.file.name})]}),e.text&&(0,c.jsx)("p",{children:e.text})]}),(0,c.jsx)("div",{className:"timestamp small-timestamp ".concat(e.sender===k?"user-sent-timestamp":"other-sent-timestamp"),children:ne(e.timestamp)})]},t):null})):(0,c.jsx)("div",{children:"No messages yet."})}),(0,c.jsxs)("div",{className:"chatui-container",children:[(0,c.jsx)("input",{type:"file",onChange:function(e){return function(e){var t=e.target.files[0];t&&(A(t),t.type&&t.type.startsWith("image/")?W(null):W({name:t.name,type:"file"}))}(e)},style:{display:"none"},ref:B}),(0,c.jsx)("button",{className:"userui-left-button",onClick:function(){return B.current.click()},children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"})})}),(0,c.jsx)("button",{"aria-label":"Send Message",onClick:$,className:" userui-right-button ",children:(0,c.jsx)("i",{className:"fas fa-paper-plane"})}),(0,c.jsx)("div",{id:"messageInputContainer",children:R&&(0,c.jsxs)("div",{className:"file-info",children:[R.type.startsWith("image/")&&(0,c.jsx)("div",{className:"image-preview-container",children:(0,c.jsx)("img",{src:URL.createObjectURL(new Blob([R],{type:R.type})),alt:"Image Preview",style:{maxWidth:"70%",height:"auto"}})}),!R.type.startsWith("image/")&&(0,c.jsxs)("div",{className:"file-details",children:[(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",color:"#212529",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",height:"25",width:"25",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"})}),(0,c.jsx)("span",{children:R.name})]}),(0,c.jsx)("button",{className:"remove-button",onClick:function(){return A(null)},children:"X"})]})}),(0,c.jsx)("textarea",{type:"text",placeholder:"Type a message...",ref:x,style:{height:z},value:g,onChange:function(e){w(e.target.value),te()},onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),$())},className:"message-input scroll-col",autoComplete:"off",inputMode:"text"})]})]})]})},H=n(7689),T=function(){var e=(0,s.useState)(!1),t=(0,r.Z)(e,2),n=t[0],a=t[1],i=(0,s.useState)(""),l=(0,r.Z)(i,2),u=l[0],d=l[1],h=(0,s.useState)(!0),f=(0,r.Z)(h,2),p=f[0],v=f[1],m=(0,s.useState)(!0),b=(0,r.Z)(m,2),k=b[0],Z=b[1],y=(0,s.useState)(!0),C=(0,r.Z)(y,2),U=C[0],N=C[1],S=(0,s.useState)(null),L=(0,r.Z)(S,2),M=L[0],E=L[1],I=(0,H.TH)().state,z=I||{},D=z.currentUserUID,T=z.otherUserUID,R=(0,s.useState)(T||null),A=(0,r.Z)(R,2),B=A[0],V=A[1];(0,s.useEffect)((function(){I&&(V(I.otherUserUID||null),console.log("Other User ID:",I.otherUserUID))}),[I]),(0,s.useEffect)((function(){d("Chat History");var e=window.matchMedia("(max-width: 768px)").matches;v(!e)}),[]);var P=function(){v((function(e){return!e})),Z(!1),N(!1)};(0,s.useEffect)((function(){window.matchMedia("(max-width: 768px)").matches&&B&&(N(!1),Z(!1),v(!0))}),[B]);return(0,s.useEffect)((function(){if(window.matchMedia("(max-width: 768px)").matches)return document.body.style.overflow="hidden",function(){document.body.style.overflow="auto"}}),[]),(0,c.jsxs)("div",{className:"chatcontainer",children:[(0,c.jsx)(o,{handleButtonClick:function(e){a(!n),d(e),N(!0),E(e)},isActive:n,toggleRightColumnVisibility:P,isLeftColumnVisible:U,activeButton:M,setActiveButton:E,otherUserUID:B,currentUserUID:D}),(0,c.jsxs)(j,{isActive:n,selectedMenu:u,toggleRightColumnVisibility:P,isMiddleColumnVisible:k,activeButton:M,setActiveButton:E,currentUserUID:D,updateOtherUserID:function(e,t){V(e),console.log("Current User ID:",t)},otherUserUID:B,children:["Chat History"===u&&(0,c.jsx)(x,{isActive:n,selectedMenu:u}),"Contacts"===u&&(0,c.jsx)(g,{isActive:n,selectedMenu:u}),"Profile"===u&&(0,c.jsx)(w,{isActive:n,selectedMenu:u})]}),B&&(0,c.jsx)(J,{isRightColumnVisible:p,toggleColumns:function(){v((function(e){return!e})),Z(!0),N(!0)},otherUserUID:B})]})}},5987:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(3366);function s(e,t){if(null==e)return{};var n,s,a=(0,r.Z)(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(s=0;s<c.length;s++)n=c[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}},3366:function(e,t,n){function r(e,t){if(null==e)return{};var n,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}n.d(t,{Z:function(){return r}})}}]);
//# sourceMappingURL=672.53b3d0a6.chunk.js.map